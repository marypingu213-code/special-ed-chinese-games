<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á¨¨‰∫åÈóúÔºöÁúãÂúñÈÅ∏Â•ΩÂ≠ó</title>
    <script src="data.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; background-color: #eef2f5; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .canvas-16-9 { width: 95vw; max-width: 1400px; aspect-ratio: 16 / 9; background-color: #fdf5e6; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); display: flex; flex-direction: column; align-items: center; padding: 2% 4%; box-sizing: border-box; overflow: hidden; }
        .header-area { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 1%; }
        h1 { color: #3498db; font-size: 2.5vw; margin: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .back-btn { background-color: #fff; color: #5a4a42; text-decoration: none; font-size: 1.5vw; font-weight: bold; padding: 10px 20px; border-radius: 50px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.2s; }
        .back-btn:hover { background-color: #f0f0f0; transform: scale(1.05); }
        .game-container { width: 100%; flex-grow: 1; background-color: #ffffff; border-radius: 20px; box-shadow: 0 8px 16px rgba(0,0,0,0.05); padding: 2% 4%; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; }
        .image-box { width: 40%; height: 35vh; background-color: #f9f9f9; border: 4px dashed #bdc3c7; border-radius: 20px; display: flex; justify-content: center; align-items: center; margin-bottom: 2%; overflow: hidden; font-size: 8vw; }
        .image-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .question-text { font-size: 4vw; font-weight: bold; color: #34495e; margin-bottom: 2%; letter-spacing: 5px; }
        .blank-spot { display: inline-block; min-width: 5vw; height: 5vw; border-bottom: 6px solid #e74c3c; color: #e74c3c; text-align: center; line-height: 5vw; margin: 0 1vw; padding: 0 1vw; transition: all 0.3s ease; }
        .correct-fill { border-bottom: 6px solid transparent; color: #2ecc71; transform: scale(1.2); }
        .options-container { display: flex; justify-content: center; gap: 2vw; flex-wrap: wrap; width: 100%; }
        .option-btn { font-size: 3vw; font-weight: bold; font-family: inherit; background-color: #3498db; color: white; border: none; border-radius: 15px; padding: 1.5vw 4vw; cursor: pointer; box-shadow: 0 6px 0 #2980b9; transition: all 0.1s ease; user-select: none; }
        .option-btn:active { transform: translateY(6px); box-shadow: none; }
        .option-btn.wrong { background-color: #95a5a6; box-shadow: 0 6px 0 #7f8c8d; cursor: not-allowed; animation: shake 0.4s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-10px); } 50% { transform: translateX(10px); } 75% { transform: translateX(-10px); } 100% { transform: translateX(0); } }
        .status-area { height: 10%; margin-top: 1%; display: flex; justify-content: center; align-items: center; gap: 2vw; }
        #feedback-msg { font-size: 2vw; font-weight: bold; color: #e67e22; margin: 0; }
        #next-btn { font-size: 1.8vw; padding: 0.8vw 2vw; background-color: #e74c3c; color: white; border: none; border-radius: 50px; cursor: pointer; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.2); font-weight: bold; transition: 0.2s; }
        #next-btn:active { transform: translateY(6px); box-shadow: none; }
        @media (min-width: 1400px) { h1 { font-size: 36px; } .back-btn { font-size: 20px; } .question-text { font-size: 56px; } .option-btn { font-size: 42px; } #feedback-msg { font-size: 28px; } #next-btn { font-size: 24px; } }
    </style>
</head>
<body>
    <div class="canvas-16-9">
        <div class="header-area">
            <h1>üëÄ Á¨¨‰∫åÈóúÔºöÁúãÂúñÈÅ∏Â•ΩÂ≠ó</h1>
            <a href="#" id="back-btn" class="back-btn">üè† ÂõûË™≤Á®ãÂ§ßÂª≥</a>
        </div>
        <div class="game-container">
            <div class="image-box" id="image-display"></div>
            <div class="question-text" id="question-display"></div>
            <div class="options-container" id="options-display"></div>
        </div>
        <div class="status-area">
            <div id="feedback-msg"></div>
            <button id="next-btn" onclick="nextQuestion()">‰∏ã‰∏ÄÈ°å ‚û°Ô∏è</button>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const lessonId = urlParams.get('id') || "2"; 
        document.getElementById('back-btn').href = `lesson.html?id=${lessonId}`;
        const questions = allLessonsData[lessonId] ? allLessonsData[lessonId].level2 : [];

        let currentIdx = 0, isWaiting = false;

        function loadQuestion() {
            if (currentIdx >= questions.length) {
                document.querySelector('.game-container').innerHTML = "<h2 style='font-size: 3vw; color: #2ecc71;'>üéâ Â§™Ê£í‰∫ÜÔºÅÊú¨ÈóúÂç°ÊåëÊà∞ÊàêÂäüÔºÅ</h2>";
                document.getElementById('feedback-msg').innerText = ""; 
                let btn = document.getElementById('next-btn');
                btn.innerText = 'üè† ÂõûË™≤Á®ãÂ§ßÂª≥'; btn.style.display = 'inline-block';
                btn.onclick = () => { window.location.href = `lesson.html?id=${lessonId}`; };
                return;
            }
            const q = questions[currentIdx]; isWaiting = false;
            document.getElementById('feedback-msg').innerText = ""; 
            
            let btn = document.getElementById('next-btn');
            btn.style.display = 'none'; btn.innerText = '‰∏ã‰∏ÄÈ°å ‚û°Ô∏è'; btn.onclick = nextQuestion;

            const imgBox = document.getElementById('image-display');
            imgBox.innerHTML = (q.image && q.image.trim() !== "") ? `<img src="${q.image}" onerror="this.outerHTML='${q.emoji}'" alt="ËºîÂä©ÂúñÁâá">` : q.emoji;

            document.getElementById('question-display').innerHTML = `${q.prefix}<span class="blank-spot" id="blank">Ôºü</span>${q.suffix}`;

            const optBox = document.getElementById('options-display'); optBox.innerHTML = "";
            let shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
            shuffledOptions.forEach(opt => {
                const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = opt;
                b.onclick = () => checkAnswer(b, opt, q.correct); optBox.appendChild(b);
            });
        }

        function checkAnswer(btn, selectedWord, correctWord) {
            if (isWaiting) return;
            if (selectedWord === correctWord) {
                isWaiting = true;
                const blank = document.getElementById('blank'); blank.innerText = correctWord; blank.classList.add('correct-fill');
                document.querySelectorAll('.option-btn').forEach(b => { if (b.innerText === correctWord) { b.style.backgroundColor = "#2ecc71"; b.style.boxShadow = "0 6px 0 #27ae60"; } else { b.style.opacity = "0.3"; } });
                document.getElementById('feedback-msg').style.color = "#2ecc71"; document.getElementById('feedback-msg').innerText = "üåü Á≠îÂ∞ç‰∫ÜÔºÅ";
                document.getElementById('next-btn').style.display = 'inline-block';
            } else {
                btn.classList.add('wrong'); btn.disabled = true;
                document.getElementById('feedback-msg').style.color = "#e74c3c"; document.getElementById('feedback-msg').innerText = "ÂÜçË©¶Ë©¶ÁúãÂñîÔºÅüí™";
                setTimeout(() => btn.classList.remove('wrong'), 400);
            }
        }

        function nextQuestion() { currentIdx++; loadQuestion(); }
        window.onload = () => { if(questions.length===0) alert("ÁÑ°Ê≠§ÈóúÂç°Ë≥áÊñô"); else loadQuestion(); };
    </script>
</body>
</html>
